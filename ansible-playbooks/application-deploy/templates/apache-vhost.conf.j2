<VirtualHost *:80>
    # ⚠️ 教学声明：此配置文件主要用于学习环境，生产环境请根据实际需求调整
    
    ServerName {{ lamp_server_name }}
    ServerAdmin admin@{{ lamp_server_name }}
    
    # 网站根目录
    DocumentRoot {{ lamp_web_root }}
    
    # 目录权限设置
    <Directory {{ lamp_web_root }}>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # 日志配置
    ErrorLog ${APACHE_LOG_DIR}/{{ lamp_server_name }}_error.log
    CustomLog ${APACHE_LOG_DIR}/{{ lamp_server_name }}_access.log combined
    
    # 默认首页
    DirectoryIndex index.php index.html index.htm
    
    # PHP 处理
    <FilesMatch \.php$>
        SetHandler application/x-httpd-php
    </FilesMatch>
    
    # 安全头部
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # 压缩配置
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
    </IfModule>
    
    # 缓存配置
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/pdf "access plus 1 month"
        ExpiresByType text/javascript "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType application/x-shockwave-flash "access plus 1 month"
        ExpiresByType image/x-icon "access plus 1 year"
        ExpiresDefault "access plus 2 days"
    </IfModule>
    
    # 错误页面
    ErrorDocument 404 /404.html
    ErrorDocument 500 /500.html
    ErrorDocument 502 /502.html
    ErrorDocument 503 /503.html
</VirtualHost>

# HTTPS 配置（如需启用请取消注释并配置证书）
#<VirtualHost *:443>
#    ServerName {{ lamp_server_name }}
#    ServerAdmin admin@{{ lamp_server_name }}
#    
#    DocumentRoot {{ lamp_web_root }}
#    
#    <Directory {{ lamp_web_root }}>
#        Options -Indexes +FollowSymLinks
#        AllowOverride All
#        Require all granted
#    </Directory>
#    
#    ErrorLog ${APACHE_LOG_DIR}/{{ lamp_server_name }}_ssl_error.log
#    CustomLog ${APACHE_LOG_DIR}/{{ lamp_server_name }}_ssl_access.log combined
#    
#    # SSL 配置
#    SSLEngine on
#    SSLCertificateFile {{ app_ssl_cert_path }}
#    SSLCertificateKeyFile {{ app_ssl_key_path }}
#    
#    # SSL 安全配置
#    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
#    SSLCipherSuite HIGH:!aNULL:!MD5
#    SSLHonorCipherOrder on
#    
#    # HSTS
#    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
#</VirtualHost>
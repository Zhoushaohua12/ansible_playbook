# ⚠️ 警告：该文件包含备份与维护服务器组的敏感参数示例，请用 ansible-vault 加密 vault_* 前缀变量。

# ========================================
# 备份策略通用配置
# ========================================

backup_root_dir: "/backup"
backup_tmp_dir: "/tmp/backup"
backup_retention_days: 30
backup_compression_method: "gzip"  # 可选: gzip, bzip2, xz, zstd
backup_verify_enabled: true
backup_notification_enabled: true

# 备份调度
backup_schedules:
  - name: "database_backup"
    cron: "0 2 * * *"
    description: "每日凌晨 2 点数据库备份"
  - name: "filesystem_backup"
    cron: "0 3 * * *"
    description: "每日凌晨 3 点文件系统备份"
  - name: "config_backup"
    cron: "0 4 * * 0"
    description: "每周日凌晨 4 点配置文件备份"

# ========================================
# 文件系统备份配置
# ========================================

filesystem_backup_enabled: true
filesystem_backup_method: "rsync"  # 可选: rsync, tar, borg
filesystem_backup_targets:
  - path: "/etc"
    exclude:
      - "/etc/cache/*"
      - "/etc/tmp/*"
  - path: "/opt/apps"
    exclude:
      - "*/node_modules/*"
      - "*/vendor/*"
      - "*.log"
  - path: "/var/www"
    exclude:
      - "*/cache/*"

rsync_options:
  - "--archive"
  - "--verbose"
  - "--compress"
  - "--delete"
  - "--hard-links"
  - "--exclude-from=/etc/backup/rsync_exclude.txt"

# ========================================
# 数据库备份配置
# ========================================

database_backup_enabled: true
database_backup_types:
  - engine: "mysql"
    method: "mysqldump"  # 可选: mysqldump, xtrabackup, physical
    compress: true
    single_transaction: true
    master_data: true
    databases:
      - name: "app_db"
        host: "10.30.0.32"
        user: "backup_user"
        password: "{{ vault_mysql_backup_password | default('请使用 ansible-vault 加密') }}"
  - engine: "postgresql"
    method: "pg_dump"
    compress: true
    format: "custom"
    databases:
      - name: "analytics"
        host: "10.30.0.33"
        user: "postgres"
        password: "{{ vault_pg_backup_password | default('请使用 ansible-vault 加密') }}"

# ========================================
# 云存储同步配置
# ========================================

cloud_sync_enabled: true
cloud_sync_provider: "s3"  # 可选: s3, oss, azure_blob, gcs
cloud_sync_schedule: "0 5 * * *"

# AWS S3 配置
s3_config:
  region: "cn-northwest-1"
  bucket: "{{ vault_backup_s3_bucket | default('my-backup-bucket') }}"
  access_key: "{{ vault_s3_access_key | default('请使用 ansible-vault 加密') }}"
  secret_key: "{{ vault_s3_secret_key | default('请使用 ansible-vault 加密') }}"
  storage_class: "STANDARD_IA"
  encryption: "AES256"
  lifecycle_days: 90

# 阿里云 OSS 配置
oss_config:
  endpoint: "oss-cn-beijing.aliyuncs.com"
  bucket: "{{ vault_backup_oss_bucket | default('my-backup-bucket') }}"
  access_key: "{{ vault_oss_access_key | default('请使用 ansible-vault 加密') }}"
  secret_key: "{{ vault_oss_secret_key | default('请使用 ansible-vault 加密') }}"
  storage_class: "IA"
  lifecycle_days: 90

# ========================================
# 备份恢复测试配置
# ========================================

restore_test_enabled: true
restore_test_schedule: "0 6 * * 0"
restore_test_target_dir: "/backup/restore_test"
restore_test_databases:
  - "app_db"
restore_test_notification: true

# ========================================
# 备份监控与告警
# ========================================

backup_monitoring_enabled: true
backup_metrics_export: true
backup_success_notification:
  enabled: true
  channels:
    - type: "email"
      recipients: "{{ vault_backup_notification_email | default('backup-team@example.com') }}"
    - type: "webhook"
      url: "{{ vault_backup_webhook | default('https://hooks.example.com/backup') }}"

backup_failure_notification:
  enabled: true
  escalation_level: "critical"
  channels:
    - type: "email"
      recipients: "{{ vault_backup_oncall_email | default('oncall@example.com') }}"
    - type: "sms"
      phone: "{{ vault_backup_oncall_phone | default('+86-138-xxxx-xxxx') }}"

# ========================================
# 备份清理策略
# ========================================

backup_cleanup_enabled: true
backup_cleanup_strategy: "grandfather-father-son"
backup_retention_policy:
  daily: 7    # 保留最近 7 天的每日备份
  weekly: 4   # 保留最近 4 周的每周备份
  monthly: 12 # 保留最近 12 个月的每月备份
  yearly: 3   # 保留最近 3 年的年度备份

# ========================================
# Vault 占位符
# ========================================

vault_mysql_backup_password: "请使用 ansible-vault 加密"
vault_pg_backup_password: "请使用 ansible-vault 加密"
vault_backup_s3_bucket: "请使用 ansible-vault 加密"
vault_s3_access_key: "请使用 ansible-vault 加密"
vault_s3_secret_key: "请使用 ansible-vault 加密"
vault_backup_oss_bucket: "请使用 ansible-vault 加密"
vault_oss_access_key: "请使用 ansible-vault 加密"
vault_oss_secret_key: "请使用 ansible-vault 加密"
vault_backup_notification_email: "请使用 ansible-vault 加密"
vault_backup_webhook: "请使用 ansible-vault 加密"
vault_backup_oncall_email: "请使用 ansible-vault 加密"
vault_backup_oncall_phone: "请使用 ansible-vault 加密"

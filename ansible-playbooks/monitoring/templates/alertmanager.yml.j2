# AlertManager é…ç½®æ–‡ä»¶
# âš ï¸ æ•™å­¦å£°æ˜ï¼šæ­¤é…ç½®æ–‡ä»¶ä¸»è¦ç”¨äºå­¦ä¹ ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒè¯·æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´

global:
  # SMTP é…ç½®
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'alertmanager@example.com'
  smtp_auth_password: 'your_smtp_password'
  
  # å…¨å±€æ¨¡æ¿æ–‡ä»¶
  templates:
    - '/etc/alertmanager/templates/*.tmpl'

# è·¯ç”±é…ç½®
route:
  # é»˜è®¤æ¥æ”¶å™¨
  receiver: 'web.hook'
  
  # åˆ†ç»„é…ç½®
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  
  # è·¯ç”±è§„åˆ™
  routes:
    # ä¸¥é‡å‘Šè­¦ç«‹å³å‘é€
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
      
    # è­¦å‘Šçº§åˆ«å‘Šè­¦
    - match:
        severity: warning
      receiver: 'warning-alerts'
      repeat_interval: 30m
      
    # ç³»ç»Ÿç›¸å…³å‘Šè­¦
    - match:
        service: system
      receiver: 'system-alerts'
      
    # Prometheus ç›¸å…³å‘Šè­¦
    - match:
        service: prometheus
      receiver: 'prometheus-alerts'
      
    # ç½‘ç»œç›¸å…³å‘Šè­¦
    - match:
        service: network
      receiver: 'network-alerts'

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœå®ä¾‹å®•æœºï¼ŒæŠ‘åˆ¶è¯¥å®ä¾‹çš„å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: 'InstanceDown'
    target_match_re:
      alertname: '(HighCPUUsage|HighMemoryUsage|DiskSpaceLow)'
    equal: ['instance']
    
  # å¦‚æœç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼ŒæŠ‘åˆ¶CPUå‘Šè­¦
  - source_match:
      alertname: 'HighSystemLoad'
    target_match:
      alertname: 'HighCPUUsage'
    equal: ['instance']

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤ Webhook æ¥æ”¶å™¨
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://localhost:5001/'
        send_resolved: true
        http_config:
          basic_auth:
            username: 'webhook_user'
            password: 'webhook_password'

  # ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@example.com'
        subject: '[CRITICAL] {{ .GroupLabels.alertname }} - {{ .GroupLabels.cluster }}'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å®ä¾‹: {{ .Labels.instance }}
          æœåŠ¡: {{ .Labels.service }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}
        send_resolved: true
        
    # Slack é€šçŸ¥
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#alerts-critical'
        title: 'ğŸš¨ ä¸¥é‡å‘Šè­¦'
        text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        send_resolved: true
        
    # é’‰é’‰é€šçŸ¥
    dingtalk_configs:
      - webhook_url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN'
        message_type: 'markdown'
        title: 'ä¸¥é‡å‘Šè­¦é€šçŸ¥'
        text: |
          # ğŸš¨ ä¸¥é‡å‘Šè­¦
          
          {{ range .Alerts }}
          ## {{ .Annotations.summary }}
          
          **æè¿°**: {{ .Annotations.description }}
          
          **çº§åˆ«**: {{ .Labels.severity }}
          
          **å®ä¾‹**: {{ .Labels.instance }}
          
          **æœåŠ¡**: {{ .Labels.service }}
          
          **æ—¶é—´**: {{ .StartsAt }}
          
          ---
          {{ end }}
        send_resolved: true

  # è­¦å‘Šçº§åˆ«å‘Šè­¦æ¥æ”¶å™¨
  - name: 'warning-alerts'
    email_configs:
      - to: 'ops@example.com'
        subject: '[WARNING] {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å®ä¾‹: {{ .Labels.instance }}
          æœåŠ¡: {{ .Labels.service }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}
        send_resolved: true
        
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#alerts-warning'
        title: 'âš ï¸ è­¦å‘Šå‘Šè­¦'
        text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
        send_resolved: true

  # ç³»ç»Ÿå‘Šè­¦æ¥æ”¶å™¨
  - name: 'system-alerts'
    email_configs:
      - to: 'sysadmin@example.com'
        subject: '[SYSTEM] {{ .GroupLabels.alertname }}'
        send_resolved: true

  # Prometheus å‘Šè­¦æ¥æ”¶å™¨
  - name: 'prometheus-alerts'
    email_configs:
      - to: 'monitoring@example.com'
        subject: '[PROMETHEUS] {{ .GroupLabels.alertname }}'
        send_resolved: true

  # ç½‘ç»œå‘Šè­¦æ¥æ”¶å™¨
  - name: 'network-alerts'
    email_configs:
      - to: 'network@example.com'
        subject: '[NETWORK] {{ .GroupLabels.alertname }}'
        send_resolved: true

# æ—¶é—´æ¨¡æ¿
time_intervals:
  - name: 'business-hours'
    time_intervals:
      - times:
          - start_time: '09:00'
            end_time: '18:00'
        weekdays: ['monday:friday']
        
  - name: 'after-hours'
    time_intervals:
      - times:
          - start_time: '18:01'
            end_time: '08:59'
        weekdays: ['monday:friday']
      - weekdays: ['saturday', 'sunday']

# é™é»˜è§„åˆ™ï¼ˆç¤ºä¾‹ï¼‰
# å¯ä»¥é€šè¿‡ API æˆ– Web UI åˆ›å»ºé™é»˜è§„åˆ™
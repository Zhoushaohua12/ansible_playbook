# 网络接口安全配置文件
# 此文件由 Ansible 自动生成，请勿手动修改
# 配置时间: {{ ansible_date_time.iso8601 }}

# 网络接口基本信息
DEVICE={{ item.name }}
BOOTPROTO={{ item.method | default('dhcp') }}
ONBOOT=yes
TYPE=Ethernet
USERCTL=no
PEERDNS=yes

# ============================================================================
# 安全配置
# ============================================================================

# 禁用 IPv6
IPV6INIT=no
IPV6_AUTOCONF=no

# 禁用源路由
IPV4_DEFROUTE=yes
IPV4_FAILURE_FATAL=no

# 网络接口安全选项
DEFROUTE={{ 'yes' if item.method == 'static' else 'yes' }}
IPV4_FAILURE_FATAL=no

# 禁用不必要的网络功能
IPV6_PEERDNS=no
IPV6_PEERROUTES=no
IPV6_MTU=no

# ============================================================================
# 静态 IP 配置 (如果配置)
# ============================================================================

{% if item.method == 'static' %}
IPADDR={{ item.address }}
NETMASK={{ item.netmask }}
{% if item.gateway is defined %}
GATEWAY={{ item.gateway }}
{% endif %}
{% endif %}

# ============================================================================
# DNS 配置
# ============================================================================

{% if item.dns_servers is defined %}
{% for dns in item.dns_servers %}
DNS{{ loop.index }}={{ dns }}
{% endfor %}
{% endif %}

# ============================================================================
# MTU 配置
# ============================================================================

{% if item.mtu is defined %}
MTU={{ item.mtu }}
{% endif %}

# ============================================================================
# MAC 地址配置
# ============================================================================

{% if item.mac_address is defined %}
HWADDR={{ item.mac_address }}
{% endif %}

# ============================================================================
# 安全增强配置
# ============================================================================

# 网络接口描述
NAME="{{ item.name | upper }} - Secure Network Interface"

# 网络接口优先级
DEFROUTE=yes
DELAY=0

# 禁用网络接口的热插拔
HOTPLUG=no

# 网络接口的 ARP 配置
ARP=yes

# 网络接口的广播配置
BROADCAST={{ item.broadcast | default('') }}

# 网络接口的网络掩码长度
PREFIX={{ item.prefix | default('') }}

# 网络接口的网络前缀
NETWORK={{ item.network | default('') }}

# ============================================================================
# VLAN 配置 (如果启用)
# ============================================================================

{% if item.vlan_id is defined %}
VLAN=yes
VLAN_ID={{ item.vlan_id }}
PHYSDEV={{ item.physical_device | default(item.name) }}
{% endif %}

# ============================================================================
# 绑定配置 (如果启用)
# ============================================================================

{% if item.bonding is defined %}
BONDING_OPTS="{{ item.bonding }}"
BONDING_MASTER={{ item.bonding_master | default('yes') }}
{% endif %}

# ============================================================================
# 桥接配置 (如果启用)
# ============================================================================

{% if item.bridge is defined %}
BRIDGE={{ item.bridge }}
STP={{ item.stp | default('off') }}
{% endif %}

# ============================================================================
# 安全区域配置
# ============================================================================

# 防火墙区域
ZONE={{ item.zone | default('public') }}

# 网络接口的访问控制
{% if item.access_control is defined %}
ACCESS_CTRL={{ item.access_control }}
{% endif %}

# 网络接口的流量控制
{% if item.traffic_control is defined %}
TC_QDISC={{ item.traffic_control.qdisc | default('fq_codel') }}
{% endif %}

# ============================================================================
# 监控配置
# ============================================================================

# 网络接口监控
MONITORING={{ item.monitoring | default('yes') }}

# 网络接口的状态监控
LINK_DELAY={{ item.link_delay | default('0') }}

# 网络接口的故障检测
LINK_DETECTION_DELAY={{ item.detection_delay | default('5') }}

# ============================================================================
# 日志配置
# ============================================================================

# 网络接口日志级别
LOG_LEVEL={{ item.log_level | default('info') }}

# 网络接口的调试模式
DEBUG={{ item.debug | default('no') }}

# ============================================================================
# 性能优化配置
# ============================================================================

# 网络接口的接收缓冲区大小
RX_QUEUE_SIZE={{ item.rx_queue_size | default('1000') }}

# 网络接口的发送缓冲区大小
TX_QUEUE_SIZE={{ item.tx_queue_size | default('1000') }}

# 网络接口的中断亲和性
IRQ_AFFINITY={{ item.irq_affinity | default('auto') }}

# ============================================================================
# 备用配置
# ============================================================================

# 网络接口的备用 IP 地址
{% if item.secondary_ips is defined %}
{% for ip in item.secondary_ips %}
IPADDR{{ loop.index + 1 }}={{ ip }}
{% endfor %}
{% endif %}

# 网络接口的别名
{% if item.alias is defined %}
ALIAS={{ item.alias }}
{% endif %}

# 网络接口的标签
{% if item.label is defined %}
LABEL={{ item.label }}
{% endif %}

# ============================================================================
# 配置完成提示
# ============================================================================

# 此配置文件包含网络接口的安全设置
# 请根据实际需求调整相关参数
# 修改后需要重启网络服务使配置生效

# 安全提醒：
# 1. 禁用不必要的服务和功能
# 2. 启用网络接口监控和日志记录
# 3. 配置适当的防火墙规则
# 4. 定期检查网络接口状态
# 5. 及时更新网络配置和安全补丁
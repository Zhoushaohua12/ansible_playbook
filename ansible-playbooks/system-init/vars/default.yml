---
# 系统初始化变量配置
# ⚠️ 重要提示：这些变量为示例配置，请在生产环境使用前根据实际情况调整

# ============================================================================
# 基础系统配置
# ============================================================================

# 系统时区和语言设置
system_timezone: "Asia/Shanghai"          # 系统时区设置
system_locale: "zh_CN.UTF-8"              # 系统语言环境

# 基础软件包集合
baseline_packages:
  # RHEL/CentOS 基础包
  rhel_centos:
    - vim                    # 文本编辑器
    - wget                   # 文件下载工具
    - curl                   # HTTP 客户端工具
    - git                    # 版本控制系统
    - htop                   # 系统监控工具
    - tree                   # 目录结构显示
    - lsof                   # 查看打开文件
    - net-tools              # 网络工具集
    - telnet                 # 远程登录工具
    - chrony                 # 时间同步服务
    - logrotate              # 日志轮转工具
    - fail2ban               # 入侵防护工具
    - rsyslog                # 系统日志服务
  
  # Ubuntu/Debian 基础包
  ubuntu_debian:
    - vim                    # 文本编辑器
    - wget                   # 文件下载工具
    - curl                   # HTTP 客户端工具
    - git                    # 版本控制系统
    - htop                   # 系统监控工具
    - tree                   # 目录结构显示
    - lsof                   # 查看打开文件
    - net-tools              # 网络工具集
    - telnet                 # 远程登录工具
    - chrony                 # 时间同步服务
    - logrotate              # 日志轮转工具
    - fail2ban               # 入侵防护工具
    - rsyslog                # 系统日志服务
    - unattended-upgrades    # 自动安全更新

# ============================================================================
# 网络配置
# ============================================================================

network_configure: true                     # 是否配置网络接口

# 网络接口配置模式
network_interfaces:
  - name: "eth0"                           # 网络接口名称
    config_file: "01-netcfg.yaml"         # Netplan 配置文件名 (Ubuntu)
    method: "static"                       # 配置方法: static/dhcp
    address: "192.168.1.100"              # 静态 IP 地址
    netmask: "255.255.255.0"              # 子网掩码
    gateway: "192.168.1.1"                # 网关地址
    dns_servers:                           # DNS 服务器列表
      - "8.8.8.8"
      - "114.114.114.114"
    mtu: 1500                             # MTU 大小

# ============================================================================
# 防火墙配置
# ============================================================================

firewall_enabled: true                     # 是否启用防火墙

# 防火墙开放端口列表
firewall_ports:
  - "22"                                  # SSH 服务端口
  - "80"                                  # HTTP 服务端口
  - "443"                                 # HTTPS 服务端口
  - "3306"                                # MySQL 数据库端口 (可选)
  - "5432"                                # PostgreSQL 数据库端口 (可选)

# ============================================================================
# SSH 安全加固配置
# ============================================================================

ssh_hardening_enabled: true                # 是否启用 SSH 安全加固

# SSH 配置参数
ssh_config:
  Port: 22                                # SSH 服务端口
  Protocol: 2                             # SSH 协议版本
  PermitRootLogin: "no"                   # 禁止 root 直接登录
  PasswordAuthentication: "no"            # 禁用密码认证 (仅密钥认证)
  PubkeyAuthentication: "yes"             # 启用公钥认证
  PermitEmptyPasswords: "no"              # 禁止空密码
  MaxAuthTries: 3                         # 最大认证尝试次数
  LoginGraceTime: 60                      # 登录宽限时间
  ClientAliveInterval: 300                # 客户端存活检查间隔
  ClientAliveCountMax: 2                  # 最大客户端存活检查次数
  X11Forwarding: "no"                     # 禁用 X11 转发
  AllowTcpForwarding: "no"                # 禁用 TCP 转发

# ============================================================================
# SELinux 配置 (RHEL/CentOS)
# ============================================================================

selinux_configure: true                    # 是否配置 SELinux
selinux_state: "enforcing"                 # SELinux 状态: enforcing/permissive/disabled

# SELinux 布尔值配置
selinux_booleans:
  - name: "httpd_can_network_connect"      # 允许 HTTP 服务网络连接
    state: "on"
  - name: "httpd_enable_homedirs"          # 允许 HTTP 服务访问用户目录
    state: "off"

# ============================================================================
# 系统审计配置
# ============================================================================

audit_enabled: true                        # 是否启用系统审计

# 审计规则列表
audit_rules:
  - "-w /etc/passwd -p wa -k identity"       # 监控密码文件修改
  - "-w /etc/shadow -p wa -k identity"       # 监控影子文件修改
  - "-w /etc/sudoers -p wa -k sudo"          # 监控 sudoers 文件修改
  - "-w /var/log/audit/ -p wa -k audit"      # 监控审计日志目录
  - "-a always,exit -F arch=b64 -S execve -k process_creation"  # 监控进程创建

# ============================================================================
# 用户管理配置
# ============================================================================

# 基础用户列表
baseline_users:
  - name: "admin"                          # 管理员用户名
    comment: "系统管理员"                   # 用户注释
    shell: "/bin/bash"                     # 用户 shell
    groups:                                 # 用户所属组
      - "sudo"
      - "adm"
    sudo_access: true                      # 是否授予 sudo 权限
    vault_ssh_public_key: ""               # SSH 公钥 (Vault 加密)
  
  - name: "monitor"                        # 监控用户名
    comment: "系统监控用户"                 # 用户注释
    shell: "/bin/bash"                     # 用户 shell
    groups:                                 # 用户所属组
      - "monitoring"
    sudo_access: false                     # 是否授予 sudo 权限

# ============================================================================
# 安全加固配置
# ============================================================================

security_hardening_level: "standard"        # 安全加固级别: basic/standard/high

# 内核安全参数
kernel_security_params:
  - name: "net.ipv4.ip_forward"            # IP 转发
    value: "0"
  - name: "net.ipv4.conf.all.send_redirects"  # 发送重定向
    value: "0"
  - name: "net.ipv4.conf.default.send_redirects"  # 默认发送重定向
    value: "0"
  - name: "net.ipv4.conf.all.accept_source_route"  # 接受源路由
    value: "0"
  - name: "net.ipv4.conf.default.accept_source_route"  # 默认接受源路由
    value: "0"
  - name: "net.ipv4.conf.all.accept_redirects"  # 接受重定向
    value: "0"
  - name: "net.ipv4.conf.default.accept_redirects"  # 默认接受重定向
    value: "0"
  - name: "net.ipv4.icmp_echo_ignore_broadcasts"  # 忽略广播 ping
    value: "1"

# 网络安全参数
network_security_params:
  - name: "net.ipv4.tcp_syncookies"        # TCP SYN cookies
    value: "1"
  - name: "net.ipv4.tcp_max_syn_backlog"   # TCP SYN 队列长度
    value: "2048"
  - name: "net.ipv4.tcp_synack_retries"   # SYN-ACK 重试次数
    value: "2"
  - name: "net.ipv4.ip_local_port_range"  # 本地端口范围
    value: "32768 61000"

# 关键文件权限配置
critical_file_permissions:
  - path: "/etc/passwd"                    # 密码文件
    mode: "0644"
  - path: "/etc/shadow"                    # 影子文件
    mode: "0000"
  - path: "/etc/group"                     # 组文件
    mode: "0644"
  - path: "/etc/gshadow"                   # 组影子文件
    mode: "0000"
  - path: "/etc/ssh/sshd_config"           # SSH 配置文件
    mode: "0600"

# 安全目录配置
secure_directories:
  - path: "/etc/secure"                    # 安全配置目录
    mode: "0750"
  - path: "/var/log/secure"                # 安全日志目录
    mode: "0750"

# 禁用的服务列表
disabled_services:
  - "bluetooth"                            # 蓝牙服务
  - "cups"                                 # 打印服务
  - "avahi-daemon"                         # Zeroconf 服务
  - "telnet"                               # Telnet 服务
  - "rsh"                                  # RSH 服务
  - "rlogin"                               # Rlogin 服务

# 启用的安全服务列表
enabled_security_services:
  - "fail2ban"                             # 入侵防护服务
  - "auditd"                               # 审计服务
  - "rsyslog"                              # 系统日志服务
  - "chrony"                               # 时间同步服务

# 安全日志规则
security_log_rules:
  - "auth,authpriv.* /var/log/auth.log"      # 认证日志
  - "*.emerg :omusrmsg:*"                    # 紧急消息
  - "mail.* -/var/log/mail.log"              # 邮件日志

# 安全定时任务
security_cron_jobs:
  - name: "每日安全扫描"                   # 任务名称
    job: "/usr/bin/security-scan.sh"       # 执行脚本
    hour: "3"                              # 执行小时
    minute: "0"                            # 执行分钟
  - name: "每周日志清理"                   # 任务名称
    job: "/usr/bin/log-cleanup.sh"         # 执行脚本
    weekday: "0"                           # 执行星期 (0=周日)
    hour: "2"                              # 执行小时
    minute: "0"                            # 执行分钟

# 应用程序安全配置
application_security_configs:
  - template: "limits.conf.j2"             # 配置模板
    dest: "/etc/security/limits.d/custom-limits.conf"  # 目标文件
  - template: "motd.j2"                    # 登录横幅模板
    dest: "/etc/motd"                      # 目标文件

# ============================================================================
# 功能开关配置
# ============================================================================

# 各类加固功能开关
kernel_hardening_enabled: true             # 内核加固开关
filesystem_hardening_enabled: true          # 文件系统加固开关
service_hardening_enabled: true             # 服务加固开关
network_hardening_enabled: true             # 网络加固开关
application_hardening_enabled: true         # 应用程序加固开关
logging_enabled: true                      # 日志功能开关
log_rotation_enabled: true                 # 日志轮转开关
security_cron_enabled: true                # 安全定时任务开关
hosts_file_hardening: true                 # hosts 文件加固开关

# ============================================================================
# 敏感数据占位符 (生产环境请使用 Vault 加密)
# ============================================================================

# ⚠️ 安全提示：
# 1. 生产环境请使用 Ansible Vault 加密存储敏感信息
# 2. 请勿在版本控制中提交明文密码和密钥
# 3. 定期轮换敏感数据和访问凭证

# Vault 加密的敏感数据占位符
vault_admin_password: ""                   # 管理员密码 (Vault 加密)
vault_ssh_private_key: ""                  # SSH 私钥 (Vault 加密)
vault_database_password: ""                # 数据库密码 (Vault 加密)
vault_api_tokens: {}                       # API 令牌字典 (Vault 加密)
vault_certificates: {}                     # 证书文件 (Vault 加密)

# ============================================================================
# 其他配置
# ============================================================================

# hosts 文件条目
hosts_entries:
  - "127.0.0.1 localhost"
  - "::1 localhost"
  - "192.168.1.100 {{ ansible_hostname }}"

# 系统限制配置
system_limits:
  - domain: "*"                            # 域名
    type: "soft"                           # 限制类型
    item: "nofile"                         # 限制项目
    value: "65536"                         # 限制值
  - domain: "*"                            # 域名
    type: "hard"                           # 限制类型
    item: "nofile"                         # 限制项目
    value: "65536"                         # 限制值

# 登录横幅配置
motd_content: |
  ================================================================
  欢迎使用 {{ ansible_distribution }} 系统
  
  系统信息:
    主机名: {{ ansible_hostname }}
    内核版本: {{ ansible_kernel }}
    系统时间: {{ ansible_date_time.iso8601 }}
  
  安全提醒:
    - 所有操作都会被记录和审计
    - 请勿泄露系统认证信息
    - 发现异常请立即联系管理员
  
  维护联系: admin@company.com
  ================================================================
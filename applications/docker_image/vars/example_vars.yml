# âš ï¸ æœ¬æ–‡ä»¶ä»…ä¸ºç¤ºä¾‹ï¼Œå ä½ç¬¦å¿…é¡»ä½¿ç”¨ Ansible Vault æˆ–ç¯å¢ƒå˜é‡æ›¿æ¢

# Docker é•œåƒç®¡ç†ç¤ºä¾‹å˜é‡é…ç½®

# Docker æœåŠ¡é…ç½®
docker_manage_service: true  # æ˜¯å¦ç®¡ç† Docker æœåŠ¡çŠ¶æ€

# æ„å»ºç¯å¢ƒé…ç½®
app_build_path: "/opt/docker-build"  # æ„å»ºç›®å½•è·¯å¾„
build_user: "builduser"  # æ„å»ºç”¨æˆ·
build_group: "buildgroup"  # æ„å»ºç»„
create_build_dir: true  # æ˜¯å¦åˆ›å»ºæ„å»ºç›®å½•

# åº”ç”¨æºç æ–‡ä»¶é…ç½®
prepare_source_code: true  # æ˜¯å¦å‡†å¤‡åº”ç”¨æºç 
app_source_files:
  - src: "app.py"
    dest: "app.py"
  - src: "requirements.txt"
    dest: "requirements.txt"
  - src: "config.py"
    dest: "config.py"
  - src: "static/"
    dest: "static/"

# Dockerfile é…ç½®
generate_dockerfile: true  # æ˜¯å¦ç”Ÿæˆ Dockerfile
dockerfile_name: "Dockerfile"  # å¼€å‘ç¯å¢ƒ Dockerfile åç§°
dockerfile_prod_name: "Dockerfile.prod"  # ç”Ÿäº§ç¯å¢ƒ Dockerfile åç§°
generate_dockerignore: true  # æ˜¯å¦ç”Ÿæˆ .dockerignore

# åŸºç¡€é•œåƒé…ç½®
base_images:
  - "python:3.11-alpine"
  - "node:18-alpine"
  - "nginx:1.21-alpine"
pull_base_images: true  # æ˜¯å¦æ‹‰å–åŸºç¡€é•œåƒ
pull_base_images_on_build: true  # æ„å»ºæ—¶æ˜¯å¦æ‹‰å–åŸºç¡€é•œåƒ

# åº”ç”¨é•œåƒé…ç½®
app_image_name: "myapp"  # åº”ç”¨é•œåƒåç§°
app_version: "v1.2.3"  # åº”ç”¨ç‰ˆæœ¬
registry_url: "registry.example.com"  # é•œåƒä»“åº“åœ°å€

# æ„å»ºå‚æ•°
build_args:
  APP_VERSION: "{{ app_version }}"
  BUILD_ENV: "development"
  BUILD_NUMBER: "42"
  GIT_COMMIT: "abc123def"

# ç”Ÿäº§ç¯å¢ƒæ„å»ºå‚æ•°
prod_build_args:
  APP_VERSION: "{{ app_version }}"
  BUILD_ENV: "production"
  BUILD_NUMBER: "42"
  GIT_COMMIT: "abc123def"
  MINIMIZE: "true"

# æ„å»ºç¼“å­˜é…ç½®
build_cache_from:
  - "python:3.11-alpine"
  - "{{ app_image_name }}:latest"

prod_build_cache_from:
  - "python:3.11-alpine"
  - "{{ app_image_name }}:latest"
  - "{{ registry_url }}/{{ app_image_name }}:stable"

# é•œåƒæ„å»ºå¼€å…³
build_dev_image: true  # æ˜¯å¦æ„å»ºå¼€å‘ç‰ˆæœ¬é•œåƒ
build_prod_image: true  # æ˜¯å¦æ„å»ºç”Ÿäº§ç‰ˆæœ¬é•œåƒ

# é•œåƒæ ‡ç­¾é…ç½®
add_image_tags: true  # æ˜¯å¦æ·»åŠ å¤šä¸ªæ ‡ç­¾
image_tags:
  - "{{ app_version }}"
  - "latest"
  - "stable"

# ä»“åº“é…ç½®
login_to_registry: true  # æ˜¯å¦ç™»å½•åˆ°ä»“åº“
registry_username: "dockeruser"  # ä»“åº“ç”¨æˆ·å
registry_password: "SecureDockerPassword123"  # ä»“åº“å¯†ç ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ Ansible Vaultï¼‰
registry_email: "docker@example.com"  # ä»“åº“é‚®ç®±
push_to_registry: true  # æ˜¯å¦æ¨é€åˆ°ä»“åº“
push_dev_image: false  # æ˜¯å¦æ¨é€å¼€å‘ç‰ˆæœ¬é•œåƒ

# å®‰å…¨æ‰«æé…ç½®
run_security_scan: true  # æ˜¯å¦è¿è¡Œå®‰å…¨æ‰«æ

# æ¸…ç†é…ç½®
old_image_versions:
  - "v1.0.0"
  - "v1.1.0"
  - "v1.2.0"
cleanup_old_images: true  # æ˜¯å¦æ¸…ç†æ—§ç‰ˆæœ¬é•œåƒ

# éªŒè¯å’Œæ˜¾ç¤ºé…ç½®
verify_images: true  # æ˜¯å¦éªŒè¯é•œåƒ
get_image_info: true  # æ˜¯å¦è·å–é•œåƒè¯¦ç»†ä¿¡æ¯
show_results: true  # æ˜¯å¦æ˜¾ç¤ºæ“ä½œç»“æœæ‘˜è¦

# åº”ç”¨ä¿¡æ¯
app_name: "My Web Application"
app_description: "åŸºäº Python Flask çš„ Web åº”ç”¨"
app_author: "DevOps Team"

# æ„å»ºç¯å¢ƒå˜é‡
build_environment:
  - "DEBIAN_FRONTEND=noninteractive"
  - "TZ=Asia/Shanghai"
  - "LANG=C.UTF-8"

# é‡è¦ï¼šè¿™äº›å˜é‡ä»…ç”¨äºæ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ Ansible Vault æˆ–å¤–éƒ¨é…ç½®ç®¡ç†
# âš ï¸ è­¦å‘Šï¼šä»“åº“å¯†ç å’Œæ•æ„Ÿä¿¡æ¯éœ€è¦å®‰å…¨å­˜å‚¨
# ğŸ”’ å®‰å…¨æç¤ºï¼šä½¿ç”¨ HTTPS è¿æ¥é•œåƒä»“åº“ï¼Œé¿å…æ˜æ–‡ä¼ è¾“
# ğŸ“ æ³¨æ„ï¼šé•œåƒæ ‡ç­¾éœ€è¦æ ¹æ®å®é™…å‘å¸ƒç­–ç•¥è°ƒæ•´
# ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨é•œåƒä»“åº“ä»£ç†å¯ä»¥åŠ é€Ÿæ‹‰å–å’Œæ¨é€
# ğŸ” å®‰å…¨å®¡è®¡ï¼šå»ºè®®å®šæœŸæ‰«æé•œåƒå®‰å…¨æ¼æ´
# ğŸ’¾ å­˜å‚¨ç®¡ç†ï¼šå®šæœŸæ¸…ç†æ— ç”¨é•œåƒé‡Šæ”¾å­˜å‚¨ç©ºé—´

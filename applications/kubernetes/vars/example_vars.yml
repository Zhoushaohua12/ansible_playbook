# âš ï¸ æœ¬æ–‡ä»¶ä»…ä¸ºç¤ºä¾‹ï¼Œå ä½ç¬¦å¿…é¡»ä½¿ç”¨ Ansible Vault æˆ–ç¯å¢ƒå˜é‡æ›¿æ¢

# Kubernetes èµ„æºç®¡ç†ç¤ºä¾‹å˜é‡é…ç½®

# é›†ç¾¤è¿æ¥é…ç½®
kubeconfig_path: "{{ ansible_user_dir }}/.kube/config"  # kubeconfig æ–‡ä»¶è·¯å¾„
cluster_context: "default"  # Kubernetes ä¸Šä¸‹æ–‡

# åº”ç”¨åŸºç¡€é…ç½®
app_name: "webapp"  # åº”ç”¨åç§°
app_version: "v1.2.3"  # åº”ç”¨ç‰ˆæœ¬
app_environment: "production"  # åº”ç”¨ç¯å¢ƒ
app_namespace: "webapp-prod"  # åº”ç”¨å‘½åç©ºé—´
create_namespace: true  # æ˜¯å¦åˆ›å»ºå‘½åç©ºé—´

# åº”ç”¨é•œåƒé…ç½®
app_image: "registry.example.com/webapp"  # åº”ç”¨é•œåƒåœ°å€
new_app_image: "registry.example.com/webapp"  # æ–°é•œåƒåœ°å€ï¼ˆç”¨äºæ›´æ–°ï¼‰
new_app_version: "v1.3.0"  # æ–°åº”ç”¨ç‰ˆæœ¬

# Deployment é…ç½®
app_deployment_name: "webapp-deployment"  # Deployment åç§°
app_container_name: "webapp"  # å®¹å™¨åç§°
app_container_port: 8080  # å®¹å™¨ç«¯å£
app_replicas: 3  # åˆå§‹å‰¯æœ¬æ•°
scale_replicas: 5  # æ‰©å®¹ç›®æ ‡å‰¯æœ¬æ•°

# åº”ç”¨èµ„æºé…ç½®
app_memory_request: "256Mi"  # å†…å­˜è¯·æ±‚
app_cpu_request: "250m"  # CPU è¯·æ±‚
app_memory_limit: "512Mi"  # å†…å­˜é™åˆ¶
app_cpu_limit: "500m"  # CPU é™åˆ¶

# å¥åº·æ£€æŸ¥é…ç½®
app_health_path: "/health"  # å¥åº·æ£€æŸ¥è·¯å¾„
app_ready_path: "/ready"  # å°±ç»ªæ£€æŸ¥è·¯å¾„

# ConfigMap é…ç½®
app_configmap_name: "webapp-config"  # ConfigMap åç§°
create_configmap: true  # æ˜¯å¦åˆ›å»º ConfigMap
configmap_data:
  app_name: "{{ app_name }}"
  app_version: "{{ app_version }}"
  log_level: "INFO"
  database_host: "postgres.example.com"
  database_port: "5432"
  redis_host: "redis.example.com"
  redis_port: "6379"
  cache_ttl: "3600"
  max_connections: "100"

# Secret é…ç½®
app_secret_name: "webapp-secrets"  # Secret åç§°
create_secret: true  # æ˜¯å¦åˆ›å»º Secret
secret_data:
  database_url: "postgresql://user:password@postgres.example.com:5432/webapp"
  redis_password: "SecureRedisPassword123"
  api_key: "SuperSecretApiKey456"
  jwt_secret: "VerySecureJWTSecret789"
  encryption_key: "EncryptionKeyForData123"

# Service é…ç½®
app_service_name: "webapp-service"  # Service åç§°
app_service_port: 80  # æœåŠ¡ç«¯å£
app_service_type: "ClusterIP"  # æœåŠ¡ç±»å‹
create_service: true  # æ˜¯å¦åˆ›å»º Service

# Ingress é…ç½®
app_ingress_name: "webapp-ingress"  # Ingress åç§°
app_domain: "webapp.example.com"  # åº”ç”¨åŸŸå
app_ingress_path: "/"  # Ingress è·¯å¾„
app_tls_secret: "webapp-tls"  # TLS è¯ä¹¦ Secret
cert_issuer: "letsencrypt-prod"  # è¯ä¹¦é¢å‘è€…
create_ingress: true  # æ˜¯å¦åˆ›å»º Ingress

# HPA é…ç½®
app_hpa_name: "webapp-hpa"  # HPA åç§°
hpa_min_replicas: 2  # æœ€å°å‰¯æœ¬æ•°
hpa_max_replicas: 10  # æœ€å¤§å‰¯æœ¬æ•°
hpa_cpu_target: 70  # CPU ç›®æ ‡åˆ©ç”¨ç‡
hpa_memory_target: 80  # å†…å­˜ç›®æ ‡åˆ©ç”¨ç‡
create_hpa: true  # æ˜¯å¦åˆ›å»º HPA

# éƒ¨ç½²æ§åˆ¶é…ç½®
deploy_app: true  # æ˜¯å¦éƒ¨ç½²åº”ç”¨
wait_for_deployment: true  # æ˜¯å¦ç­‰å¾…éƒ¨ç½²å®Œæˆ
deployment_wait_timeout: 300  # éƒ¨ç½²ç­‰å¾…è¶…æ—¶æ—¶é—´
deployment_wait_retries: 10  # éƒ¨ç½²ç­‰å¾…é‡è¯•æ¬¡æ•°
deployment_wait_delay: 30  # éƒ¨ç½²ç­‰å¾…å»¶è¿Ÿ

# é¢å¤–èµ„æºé…ç½®
deploy_additional_resources: false  # æ˜¯å¦éƒ¨ç½²é¢å¤–èµ„æº
additional_manifests:
  - "/opt/k8s/manifests/pvc.yaml"
  - "/opt/k8s/manifests/networkpolicy.yaml"
  - "/opt/k8s/manifests/resourcequota.yaml"

# åº”ç”¨æ“ä½œé…ç½®
scale_app: false  # æ˜¯å¦æ‰©å®¹åº”ç”¨
update_app_image: false  # æ˜¯å¦æ›´æ–°åº”ç”¨é•œåƒ

# ä¿¡æ¯è·å–é…ç½®
get_pod_info: true  # æ˜¯å¦è·å– Pod ä¿¡æ¯
get_service_info: true  # æ˜¯å¦è·å– Service ä¿¡æ¯

# æ˜¾ç¤ºé…ç½®
show_results: true  # æ˜¯å¦æ˜¾ç¤ºæ“ä½œç»“æœæ‘˜è¦

# ç¯å¢ƒæ ‡ç­¾
environment_labels:
  production:
    environment: "production"
    team: "platform"
    cost-center: "engineering"
  staging:
    environment: "staging"
    team: "platform"
    cost-center: "engineering"
  development:
    environment: "development"
    team: "platform"
    cost-center: "engineering"

# é‡è¦ï¼šè¿™äº›å˜é‡ä»…ç”¨äºæ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ Ansible Vault æˆ–å¤–éƒ¨é…ç½®ç®¡ç†
# âš ï¸ è­¦å‘Šï¼šSecret ä¸­çš„æ•æ„Ÿä¿¡æ¯éœ€è¦åŠ å¯†å­˜å‚¨
# ğŸ”’ å®‰å…¨æç¤ºï¼šä½¿ç”¨ RBAC é™åˆ¶å¯¹é›†ç¾¤çš„è®¿é—®æƒé™
# ğŸ“ æ³¨æ„ï¼šèµ„æºåç§°å’Œå‘½åç©ºé—´éœ€è¦æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´
# ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼šæ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´èµ„æºé™åˆ¶å’Œå‰¯æœ¬æ•°
# ğŸ” ç›‘æ§å»ºè®®ï¼šé…ç½® Prometheus ç›‘æ§å’Œå‘Šè­¦è§„åˆ™
# ğŸ›¡ï¸ å®‰å…¨åŠ å›ºï¼šå¯ç”¨ç½‘ç»œç­–ç•¥å’Œ Pod å®‰å…¨ç­–ç•¥
# ğŸ“Š å®¹é‡è§„åˆ’ï¼šæ ¹æ®ä¸šåŠ¡å¢é•¿è§„åˆ’é›†ç¾¤èµ„æº

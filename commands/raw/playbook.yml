---
- name: raw æ¨¡å—æ—  Python ç¯å¢ƒå‘½ä»¤æ‰§è¡Œç¤ºä¾‹
  hosts: all
  become: false
  vars_files:
    - vars/example_vars.yml
  
  tasks:
    - name: ä¸­æ–‡æé†’ - æ£€æŸ¥ Python ç¯å¢ƒ
      ansible.builtin.raw: |
        # æ£€æŸ¥ Python æ˜¯å¦å¯ç”¨
        echo "æ£€æŸ¥ Python ç¯å¢ƒ..."
        which python3 && echo "Python3 å·²å®‰è£…" || echo "Python3 æœªå®‰è£…"
      register: python_check
      changed_when: false
    
    - name: æ˜¾ç¤º Python æ£€æŸ¥ç»“æœ
      ansible.builtin.debug:
        msg: |
          Python ç¯å¢ƒæ£€æŸ¥ç»“æœï¼š
          {{ python_check.stdout_lines | join('\n') }}
    
    - name: ä¸­æ–‡æé†’ - åœ¨æ—  Python ç¯å¢ƒæ—¶å®‰è£…åŸºç¡€è½¯ä»¶
      ansible.builtin.raw: |
        # ä»…åœ¨ Python ä¸å­˜åœ¨æ—¶å®‰è£…ï¼ˆä½¿ç”¨åŸå§‹åŒ…ç®¡ç†å™¨å‘½ä»¤ï¼‰
        echo "å¼€å§‹å®‰è£… Python å’ŒåŸºç¡€å·¥å…·..."
        
        # æ£€æµ‹æ“ä½œç³»ç»Ÿç±»å‹
        if [ -f /etc/debian_version ]; then
          echo "æ£€æµ‹åˆ° Debian/Ubuntu ç³»ç»Ÿ"
          apt-get update
          apt-get install -y {{ raw_python_package }} {{ raw_python_pip }} {{ raw_basic_packages | join(' ') }}
        elif [ -f /etc/redhat-release ]; then
          echo "æ£€æµ‹åˆ° RedHat/CentOS ç³»ç»Ÿ"
          yum install -y {{ raw_python_package }} {{ raw_python_pip }} {{ raw_basic_packages | join(' ') }}
        elif [ -f /etc/alpine-release ]; then
          echo "æ£€æµ‹åˆ° Alpine Linux ç³»ç»Ÿ"
          apk update
          apk add {{ raw_python_package }} {{ raw_python_pip }} {{ raw_basic_packages | join(' ') }}
        else
          echo "æœªè¯†åˆ«çš„æ“ä½œç³»ç»Ÿï¼Œè¯·æ‰‹åŠ¨å®‰è£… Python"
          exit 1
        fi
        
        echo "å®‰è£…å®Œæˆ"
      register: python_install
      when: "'Python3 æœªå®‰è£…' in python_check.stdout"
    
    - name: æ˜¾ç¤ºå®‰è£…ç»“æœ
      ansible.builtin.debug:
        msg: |
          Python å®‰è£…ç»“æœï¼š
          {{ python_install.stdout_lines | default(['å®‰è£…è·³è¿‡']) | join('\n') }}
      when: python_install is defined
    
    - name: ä¸­æ–‡æé†’ - éªŒè¯ç³»ç»ŸåŸºæœ¬ä¿¡æ¯
      ansible.builtin.raw: |
        # ä½¿ç”¨åŸå§‹å‘½ä»¤è·å–ç³»ç»Ÿä¿¡æ¯
        echo "=== ç³»ç»ŸåŸºæœ¬ä¿¡æ¯ ==="
        echo "ä¸»æœºå: $(hostname)"
        echo "å†…æ ¸ç‰ˆæœ¬: $(uname -r)"
        echo "ç³»ç»Ÿæ—¶é—´: $(date)"
        echo "å½“å‰ç”¨æˆ·: $(whoami)"
        echo "å·¥ä½œç›®å½•: $(pwd)"
        
        if [ -f {{ raw_os_release_file }} ]; then
          echo ""
          echo "=== æ“ä½œç³»ç»Ÿä¿¡æ¯ ==="
          cat {{ raw_os_release_file }}
        fi
      register: system_info
      changed_when: false
    
    - name: æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
      ansible.builtin.debug:
        msg: |
          {{ system_info.stdout_lines | join('\n') }}
    
    - name: ä¸­æ–‡æé†’ - æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€
      ansible.builtin.raw: |
        # æ£€æŸ¥ç½‘ç»œæ¥å£çŠ¶æ€
        echo "=== ç½‘ç»œæ¥å£çŠ¶æ€ ==="
        ip addr show {{ raw_network_interface }} || ifconfig {{ raw_network_interface }}
        
        echo ""
        echo "=== è·¯ç”±ä¿¡æ¯ ==="
        ip route show default || route -n
        
        echo ""
        echo "=== DNS é…ç½® ==="
        cat /etc/resolv.conf
      register: network_info
      changed_when: false
      failed_when: false
    
    - name: æ˜¾ç¤ºç½‘ç»œä¿¡æ¯
      ansible.builtin.debug:
        msg: |
          {{ network_info.stdout_lines | default(['ç½‘ç»œä¿¡æ¯è·å–å¤±è´¥']) | join('\n') }}
    
    - name: ä¸­æ–‡æé†’ - æ£€æŸ¥ç£ç›˜ç©ºé—´
      ansible.builtin.raw: |
        # æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
        echo "=== ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ ==="
        df -h
        
        echo ""
        echo "=== å†…å­˜ä½¿ç”¨æƒ…å†µ ==="
        free -h || cat /proc/meminfo | head -10
      register: resource_info
      changed_when: false
      failed_when: false
    
    - name: æ˜¾ç¤ºèµ„æºä¿¡æ¯
      ansible.builtin.debug:
        msg: |
          {{ resource_info.stdout_lines | default(['èµ„æºä¿¡æ¯è·å–å¤±è´¥']) | join('\n') }}
    
    - name: ä¸­æ–‡æé†’ - åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•
      ansible.builtin.raw: |
        # åˆ›å»ºå·¥ä½œç›®å½•
        echo "åˆ›å»ºä¸´æ—¶å·¥ä½œç›®å½•: {{ raw_temp_directory }}"
        mkdir -p {{ raw_temp_directory }}
        echo "ç›®å½•åˆ›å»ºå®Œæˆ"
        ls -la {{ raw_temp_directory }}
      register: temp_dir_result
      args:
        creates: "{{ raw_temp_directory }}"
    
    - name: æ˜¾ç¤ºç›®å½•åˆ›å»ºç»“æœ
      ansible.builtin.debug:
        msg: |
          {{ temp_dir_result.stdout_lines | default(['ç›®å½•å·²å­˜åœ¨']) | join('\n') }}
    
    - name: ä¸­æ–‡æé†’ - æ¸…ç†æ¼”ç¤ºï¼ˆé»˜è®¤ç¦ç”¨ï¼‰
      ansible.builtin.raw: |
        # æ¸…ç†ä¸´æ—¶ç›®å½•ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
        echo "æ¸…ç†ä¸´æ—¶ç›®å½•: {{ raw_temp_directory }}"
        rm -rf {{ raw_temp_directory }}
        echo "æ¸…ç†å®Œæˆ"
      register: cleanup_result
      when: false  # é»˜è®¤ç¦ç”¨æ¸…ç†ï¼Œå¯æ‰‹åŠ¨å¯ç”¨
      args:
        removes: "{{ raw_temp_directory }}"
    
    - name: é‡è¦æé†’ - raw æ¨¡å—ä½¿ç”¨è¯´æ˜
      ansible.builtin.debug:
        msg: |
          ğŸš¨ é‡è¦æé†’ï¼šraw æ¨¡å—ä½¿ç”¨æ³¨æ„äº‹é¡¹
          
          1. å®‰å…¨é£é™©ï¼šraw æ¨¡å—ç»•è¿‡ Ansible çš„å®‰å…¨æœºåˆ¶ï¼Œå­˜åœ¨è¾ƒé«˜å®‰å…¨é£é™©
          2. å¹‚ç­‰æ€§ï¼šæ— æ³•ä¿è¯å‘½ä»¤æ‰§è¡Œçš„å¹‚ç­‰æ€§ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†é‡å¤æ‰§è¡Œé—®é¢˜
          3. é”™è¯¯å¤„ç†ï¼šé”™è¯¯ä¿¡æ¯å¯èƒ½ä¸å¤Ÿè¯¦ç»†ï¼Œè°ƒè¯•éš¾åº¦è¾ƒå¤§
          4. é€‚ç”¨åœºæ™¯ï¼šä»…åœ¨ç›®æ ‡ä¸»æœºæ—  Python ç¯å¢ƒæˆ–ç³»ç»Ÿå¼•å¯¼é˜¶æ®µä½¿ç”¨
          
          å»ºè®®ï¼šåœ¨ Python ç¯å¢ƒå¯ç”¨åï¼Œä¼˜å…ˆä½¿ç”¨ shellã€command æˆ– script æ¨¡å—
# auditd.conf - 审计守护进程配置文件
# 此文件由 Ansible 模板生成，请勿手动修改

# 日志文件配置
log_file = {{ auditd_config.log_file | default('/var/log/audit/audit.log') }}
log_format = {{ auditd_config.log_format | default('RAW') }}
log_group = {{ auditd_config.log_group | default('root') }}

# 性能配置
priority_boost = {{ auditd_config.priority_boost | default(4) }}
flush = {{ auditd_config.flush | default('INCREMENTAL') }}
freq = {{ auditd_config.freq | default(20) }}

# 日志轮转配置
max_log_file = {{ auditd_config.max_log_file | default(50) }}
num_logs = {{ auditd_config.num_logs | default(5) }}
max_log_file_action = {{ auditd_config.max_log_file_action | default('ROTATE') }}

# 磁盘空间管理
space_left = {{ auditd_config.space_left | default(75) }}
space_left_action = {{ auditd_config.space_left_action | default('SYSLOG') }}
admin_space_left = {{ auditd_config.admin_space_left | default(50) }}
admin_space_left_action = {{ auditd_config.admin_space_left_action | default('SUSPEND') }}

# 磁盘错误处理
disk_full_action = {{ auditd_config.disk_full_action | default('SUSPEND') }}
disk_error_action = {{ auditd_config.disk_error_action | default('SUSPEND') }}

# 远程审计配置（如果启用）
{% if enable_remote_audit | default(false) %}
remote_server = {{ vault_auditd_remote_server }}
remote_port = {{ vault_auditd_remote_port | default(60) }}
remote_aukey = {{ vault_auditd_remote_key }}
{% endif %}

# 其他配置
tcp_listen_port = {{ auditd_config.tcp_listen_port | default(0) }}
tcp_listen_queue = {{ auditd_config.tcp_listen_queue | default(5) }}
tcp_max_per_addr = {{ auditd_config.tcp_max_per_addr | default(1) }}
tcp_client_ports = {{ auditd_config.tcp_client_ports | default('1024-65535') }}
tcp_client_max_idle = {{ auditd_config.tcp_client_max_idle | default(0) }}

# 启用/禁用审计
enable_krb5 = {{ auditd_config.enable_krb5 | default('no') }}
krb5_principal = {{ auditd_config.krb5_principal | default('') }}

# 网络配置
name_format = {{ auditd_config.name_format | default('NONE') }
name = {{ auditd_config.name | default('') }}

# 最大重启次数
max_restarts = {{ auditd_config.max_restarts | default(10) }}
# Git å·¥ä½œæµç¤ºä¾‹å˜é‡é…ç½®

# Git å®¢æˆ·ç«¯é…ç½®
install_git: true  # æ˜¯å¦å®‰è£… Git å®¢æˆ·ç«¯

# éƒ¨ç½²ç¯å¢ƒé…ç½®
deploy_base_path: "/opt/apps"  # éƒ¨ç½²åŸºç¡€è·¯å¾„
deploy_user: "appuser"  # éƒ¨ç½²ç”¨æˆ·
deploy_group: "appgroup"  # éƒ¨ç½²ç»„
create_deploy_dirs: true  # æ˜¯å¦åˆ›å»ºéƒ¨ç½²ç›®å½•

# SSH è®¤è¯é…ç½®
ssh_key_file: "/home/{{ deploy_user }}/.ssh/id_rsa"  # SSH ç§é’¥æ–‡ä»¶è·¯å¾„
accept_hostkey: true  # æ˜¯å¦æ¥å—ä¸»æœºå¯†é’¥

# å…‹éš†é…ç½®
clone_depth: 50  # å…‹éš†æ·±åº¦ï¼ˆ0 è¡¨ç¤ºå®Œæ•´å…‹éš†ï¼‰
force_prod_deploy: true  # æ˜¯å¦å¼ºåˆ¶ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
force_staging_deploy: true  # æ˜¯å¦å¼ºåˆ¶é¢„å‘å¸ƒç¯å¢ƒéƒ¨ç½²
force_dev_deploy: true  # æ˜¯å¦å¼ºåˆ¶å¼€å‘ç¯å¢ƒéƒ¨ç½²

# ç”Ÿäº§ç¯å¢ƒé…ç½®
deploy_production: true  # æ˜¯å¦éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ
prod_app_repository: "git@github.com:company/production-app.git"  # ç”Ÿäº§ç¯å¢ƒä»“åº“
prod_deploy_path: "{{ deploy_base_path }}/production"  # ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è·¯å¾„
prod_version: "v2.1.3"  # ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬

# é¢„å‘å¸ƒç¯å¢ƒé…ç½®
deploy_staging: true  # æ˜¯å¦éƒ¨ç½²é¢„å‘å¸ƒç¯å¢ƒ
staging_app_repository: "git@github.com:company/staging-app.git"  # é¢„å‘å¸ƒç¯å¢ƒä»“åº“
staging_deploy_path: "{{ deploy_base_path }}/staging"  # é¢„å‘å¸ƒç¯å¢ƒéƒ¨ç½²è·¯å¾„
staging_version: "develop"  # é¢„å‘å¸ƒç¯å¢ƒç‰ˆæœ¬

# å¼€å‘ç¯å¢ƒé…ç½®
deploy_development: true  # æ˜¯å¦éƒ¨ç½²å¼€å‘ç¯å¢ƒ
dev_app_repository: "git@github.com:company/development-app.git"  # å¼€å‘ç¯å¢ƒä»“åº“
dev_deploy_path: "{{ deploy_base_path }}/development"  # å¼€å‘ç¯å¢ƒéƒ¨ç½²è·¯å¾„
dev_version: "feature/new-feature"  # å¼€å‘ç¯å¢ƒç‰ˆæœ¬

# å¤šç¯å¢ƒéƒ¨ç½²é…ç½®
deploy_multi_env: true  # æ˜¯å¦éƒ¨ç½²å¤šç¯å¢ƒ
multi_env_repository: "git@github.com:company/multi-env-app.git"  # å¤šç¯å¢ƒä»“åº“
multi_env_deployments:
  - env_name: "test"
    branch: "test"
    deploy_path: "{{ deploy_base_path }}/test"
  - env_name: "qa"
    branch: "qa"
    deploy_path: "{{ deploy_base_path }}/qa"
  - env_name: "hotfix"
    branch: "hotfix/emergency-fix"
    deploy_path: "{{ deploy_base_path }}/hotfix"

# å­æ¨¡å—é…ç½®
deploy_with_submodules: true  # æ˜¯å¦éƒ¨ç½²åŒ…å«å­æ¨¡å—çš„é¡¹ç›®
submodule_repository: "git@github.com:company/app-with-submodules.git"  # åŒ…å«å­æ¨¡å—çš„ä»“åº“
submodule_deploy_path: "{{ deploy_base_path }}/submodules"  # å­æ¨¡å—éƒ¨ç½²è·¯å¾„
submodule_version: "v1.5.2"  # å­æ¨¡å—ç‰ˆæœ¬

# å¤‡ä»½é…ç½®
create_backup: true  # æ˜¯å¦åˆ›å»ºç‰ˆæœ¬å¤‡ä»½
backup_repository: "git@github.com:company/backup-repo.git"  # å¤‡ä»½ä»“åº“
backup_path: "{{ deploy_base_path }}/backup"  # å¤‡ä»½è·¯å¾„
backup_tag: "backup-{{ ansible_date_time.epoch }}"  # å¤‡ä»½æ ‡ç­¾

# éƒ¨ç½²è·¯å¾„åˆ—è¡¨ï¼ˆç”¨äºæƒé™è®¾ç½®ç­‰æ“ä½œï¼‰
deployment_paths:
  - "{{ prod_deploy_path }}"
  - "{{ staging_deploy_path }}"
  - "{{ dev_deploy_path }}"

# éªŒè¯é…ç½®
verify_deployments: true  # æ˜¯å¦éªŒè¯éƒ¨ç½²ç‰ˆæœ¬
get_remote_info: true  # æ˜¯å¦è·å–è¿œç¨‹ä»“åº“ä¿¡æ¯
get_branch_info: true  # æ˜¯å¦è·å–åˆ†æ”¯ä¿¡æ¯
get_tag_info: true  # æ˜¯å¦è·å–æ ‡ç­¾ä¿¡æ¯

# æƒé™å’Œæ–‡ä»¶é…ç½®
set_permissions: true  # æ˜¯å¦è®¾ç½®ç›®å½•æƒé™
create_deployment_info: true  # æ˜¯å¦åˆ›å»ºéƒ¨ç½²ä¿¡æ¯æ–‡ä»¶

# æ˜¾ç¤ºé…ç½®
show_results: true  # æ˜¯å¦æ˜¾ç¤ºæ“ä½œç»“æœæ‘˜è¦

# å›æ»šé…ç½®
rollback_version: "v2.1.2"  # å›æ»šç›®æ ‡ç‰ˆæœ¬

# åº”ç”¨ä¿¡æ¯
app_name: "Web Application"
app_description: "åŸºäº Git å·¥ä½œæµçš„ Web åº”ç”¨éƒ¨ç½²"
app_owner: "DevOps Team"

# éƒ¨ç½²ç¯å¢ƒä¿¡æ¯
environments:
  production:
    name: "ç”Ÿäº§ç¯å¢ƒ"
    branch: "main"
    auto_deploy: false
    require_approval: true
  staging:
    name: "é¢„å‘å¸ƒç¯å¢ƒ"
    branch: "develop"
    auto_deploy: true
    require_approval: false
  development:
    name: "å¼€å‘ç¯å¢ƒ"
    branch: "feature/*"
    auto_deploy: true
    require_approval: false

# Git é…ç½®
git_config:
  user.name: "Deployment Bot"
  user.email: "deployment@company.com"
  core.autocrlf: false
  pull.rebase: true

# é‡è¦ï¼šè¿™äº›å˜é‡ä»…ç”¨äºæ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ Ansible Vault æˆ–å¤–éƒ¨é…ç½®ç®¡ç†
# âš ï¸ è­¦å‘Šï¼šSSH ç§é’¥éœ€è¦å®‰å…¨å­˜å‚¨ï¼Œå»ºè®®ä½¿ç”¨ Ansible Vault åŠ å¯†
# ğŸ”’ å®‰å…¨æç¤ºï¼šä½¿ç”¨æœ€å°æƒé™åŸåˆ™é…ç½®ä»“åº“è®¿é—®æƒé™
# ğŸ“ æ³¨æ„ï¼šä»“åº“ URL å’Œç‰ˆæœ¬éœ€è¦æ ¹æ®å®é™…é¡¹ç›®è°ƒæ•´
# ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼šæ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´å…‹éš†æ·±åº¦å’Œå¹¶å‘æ•°
# ğŸ” ç›‘æ§å»ºè®®ï¼šç›‘æ§éƒ¨ç½²æ“ä½œçš„æˆåŠŸç‡å’Œè€—æ—¶
# ğŸ›¡ï¸ å®‰å…¨åŠ å›ºï¼šå®šæœŸè½®æ¢ SSH å¯†é’¥å’Œè®¿é—®ä»¤ç‰Œ
# ğŸ“Š å®¹é‡è§„åˆ’ï¼šç›‘æ§éƒ¨ç½²ç›®å½•çš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
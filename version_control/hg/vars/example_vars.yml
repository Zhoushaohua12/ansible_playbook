# Mercurial (Hg) ä»“åº“ç®¡ç†ç¤ºä¾‹å˜é‡é…ç½®

# Mercurial å®¢æˆ·ç«¯é…ç½®
install_mercurial: true  # æ˜¯å¦å®‰è£… Mercurial å®¢æˆ·ç«¯

# éƒ¨ç½²ç¯å¢ƒé…ç½®
deploy_base_path: "/opt/hg-apps"  # éƒ¨ç½²åŸºç¡€è·¯å¾„
deploy_user: "hguser"  # éƒ¨ç½²ç”¨æˆ·
deploy_group: "hggroup"  # éƒ¨ç½²ç»„
create_deploy_dirs: true  # æ˜¯å¦åˆ›å»ºéƒ¨ç½²ç›®å½•

# SSH è®¤è¯é…ç½®
ssh_key_file: "/home/{{ deploy_user }}/.ssh/id_rsa"  # SSH ç§é’¥æ–‡ä»¶è·¯å¾„

# HTTP è®¤è¯é…ç½®
hg_username: "hguser"  # Mercurial HTTP è®¤è¯ç”¨æˆ·å
hg_password: "SecureHgPassword123"  # Mercurial HTTP è®¤è¯å¯†ç ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ Ansible Vaultï¼‰

# éƒ¨ç½²æ§åˆ¶é…ç½®
force_prod_deploy: true  # æ˜¯å¦å¼ºåˆ¶ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
force_staging_deploy: true  # æ˜¯å¦å¼ºåˆ¶é¢„å‘å¸ƒç¯å¢ƒéƒ¨ç½²
force_dev_deploy: true  # æ˜¯å¦å¼ºåˆ¶å¼€å‘ç¯å¢ƒéƒ¨ç½²
purge_prod_deploy: true  # æ˜¯å¦æ¸…ç†ç”Ÿäº§ç¯å¢ƒæœªè·Ÿè¸ªæ–‡ä»¶
purge_staging_deploy: true  # æ˜¯å¦æ¸…ç†é¢„å‘å¸ƒç¯å¢ƒæœªè·Ÿè¸ªæ–‡ä»¶
purge_dev_deploy: false  # æ˜¯å¦æ¸…ç†å¼€å‘ç¯å¢ƒæœªè·Ÿè¸ªæ–‡ä»¶

# ç”Ÿäº§ç¯å¢ƒé…ç½®
deploy_production: true  # æ˜¯å¦éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ
prod_app_repository: "ssh://hg@bitbucket.org/company/production-app"  # ç”Ÿäº§ç¯å¢ƒä»“åº“
prod_deploy_path: "{{ deploy_base_path }}/production"  # ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è·¯å¾„
prod_revision: "stable"  # ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬

# é¢„å‘å¸ƒç¯å¢ƒé…ç½®
deploy_staging: true  # æ˜¯å¦éƒ¨ç½²é¢„å‘å¸ƒç¯å¢ƒ
staging_app_repository: "ssh://hg@bitbucket.org/company/staging-app"  # é¢„å‘å¸ƒç¯å¢ƒä»“åº“
staging_deploy_path: "{{ deploy_base_path }}/staging"  # é¢„å‘å¸ƒç¯å¢ƒéƒ¨ç½²è·¯å¾„
staging_revision: "default"  # é¢„å‘å¸ƒç¯å¢ƒç‰ˆæœ¬

# å¼€å‘ç¯å¢ƒé…ç½®
deploy_development: true  # æ˜¯å¦éƒ¨ç½²å¼€å‘ç¯å¢ƒ
dev_app_repository: "ssh://hg@bitbucket.org/company/development-app"  # å¼€å‘ç¯å¢ƒä»“åº“
dev_deploy_path: "{{ deploy_base_path }}/development"  # å¼€å‘ç¯å¢ƒéƒ¨ç½²è·¯å¾„
dev_revision: "tip"  # å¼€å‘ç¯å¢ƒç‰ˆæœ¬

# å¤šç¯å¢ƒéƒ¨ç½²é…ç½®
deploy_multi_env: true  # æ˜¯å¦éƒ¨ç½²å¤šç¯å¢ƒ
multi_env_repository: "ssh://hg@bitbucket.org/company/multi-env-app"  # å¤šç¯å¢ƒä»“åº“
multi_env_deployments:
  - env_name: "test"
    branch: "test"
    deploy_path: "{{ deploy_base_path }}/test"
  - env_name: "qa"
    branch: "qa"
    deploy_path: "{{ deploy_base_path }}/qa"
  - env_name: "feature-x"
    branch: "feature/new-feature-x"
    deploy_path: "{{ deploy_base_path }}/feature-x"
  - env_name: "hotfix"
    branch: "hotfix/emergency-fix"
    deploy_path: "{{ deploy_base_path }}/hotfix"

# HTTP è®¤è¯éƒ¨ç½²é…ç½®
deploy_http_auth: true  # æ˜¯å¦ä½¿ç”¨ HTTP è®¤è¯éƒ¨ç½²
http_auth_repository: "https://bitbucket.org/company/private-repo"  # HTTP è®¤è¯ä»“åº“
http_auth_deploy_path: "{{ deploy_base_path }}/http-auth"  # HTTP è®¤è¯éƒ¨ç½²è·¯å¾„
http_auth_revision: "default"  # HTTP è®¤è¯ç‰ˆæœ¬
force_http_auth_deploy: true  # æ˜¯å¦å¼ºåˆ¶ HTTP è®¤è¯éƒ¨ç½²

# æ ‡ç­¾éƒ¨ç½²é…ç½®
deploy_tag_version: true  # æ˜¯å¦éƒ¨ç½²æ ‡ç­¾ç‰ˆæœ¬
tag_repository: "ssh://hg@bitbucket.org/company/tagged-app"  # æ ‡ç­¾ä»“åº“
tag_deploy_path: "{{ deploy_base_path }}/tagged"  # æ ‡ç­¾éƒ¨ç½²è·¯å¾„
tag_revision: "v2.1.3"  # æ ‡ç­¾ç‰ˆæœ¬
force_tag_deploy: true  # æ˜¯å¦å¼ºåˆ¶æ ‡ç­¾éƒ¨ç½²

# å¤‡ä»½é…ç½®
create_backup: true  # æ˜¯å¦åˆ›å»ºç‰ˆæœ¬å¤‡ä»½
backup_repository: "ssh://hg@bitbucket.org/company/backup-repo"  # å¤‡ä»½ä»“åº“
backup_path: "{{ deploy_base_path }}/backup"  # å¤‡ä»½è·¯å¾„
backup_revision: "tip"  # å¤‡ä»½ç‰ˆæœ¬
force_backup_deploy: true  # æ˜¯å¦å¼ºåˆ¶å¤‡ä»½éƒ¨ç½²

# éƒ¨ç½²è·¯å¾„åˆ—è¡¨ï¼ˆç”¨äºæƒé™è®¾ç½®ç­‰æ“ä½œï¼‰
deployment_paths:
  - "{{ prod_deploy_path }}"
  - "{{ staging_deploy_path }}"
  - "{{ dev_deploy_path }}"
  - "{{ http_auth_deploy_path }}"
  - "{{ tag_deploy_path }}"

# éªŒè¯é…ç½®
verify_deployments: true  # æ˜¯å¦éªŒè¯éƒ¨ç½²ç‰ˆæœ¬
get_branch_info: true  # æ˜¯å¦è·å–åˆ†æ”¯ä¿¡æ¯
get_tag_info: true  # æ˜¯å¦è·å–æ ‡ç­¾ä¿¡æ¯
get_paths_info: true  # æ˜¯å¦è·å–ä»“åº“è·¯å¾„ä¿¡æ¯
get_summary_info: true  # æ˜¯å¦è·å–ä»“åº“æ‘˜è¦ä¿¡æ¯

# æƒé™å’Œæ–‡ä»¶é…ç½®
set_permissions: true  # æ˜¯å¦è®¾ç½®ç›®å½•æƒé™
create_deployment_info: true  # æ˜¯å¦åˆ›å»ºéƒ¨ç½²ä¿¡æ¯æ–‡ä»¶
configure_hg_user: true  # æ˜¯å¦é…ç½® Mercurial ç”¨æˆ·ä¿¡æ¯

# Mercurial ç”¨æˆ·é…ç½®
hg_user_name: "Deployment Bot"  # Mercurial ç”¨æˆ·å
hg_user_email: "deployment@company.com"  # Mercurial ç”¨æˆ·é‚®ç®±

# æ˜¾ç¤ºé…ç½®
show_results: true  # æ˜¯å¦æ˜¾ç¤ºæ“ä½œç»“æœæ‘˜è¦

# å›æ»šé…ç½®
rollback_changeset: "a1b2c3d4e5f6"  # å›æ»šç›®æ ‡ changeset

# åº”ç”¨ä¿¡æ¯
app_name: "Hg Web Application"
app_description: "åŸºäº Mercurial å·¥ä½œæµçš„ Web åº”ç”¨éƒ¨ç½²"
app_owner: "DevOps Team"

# éƒ¨ç½²ç¯å¢ƒä¿¡æ¯
environments:
  production:
    name: "ç”Ÿäº§ç¯å¢ƒ"
    branch: "stable"
    auto_deploy: false
    require_approval: true
    purge: true
  staging:
    name: "é¢„å‘å¸ƒç¯å¢ƒ"
    branch: "default"
    auto_deploy: true
    require_approval: false
    purge: true
  development:
    name: "å¼€å‘ç¯å¢ƒ"
    branch: "tip"
    auto_deploy: true
    require_approval: false
    purge: false

# Mercurial åˆ†æ”¯ç­–ç•¥
branch_strategy:
  main_branch: "default"  # ä¸»åˆ†æ”¯
  stable_branch: "stable"  # ç¨³å®šåˆ†æ”¯
  feature_branch_prefix: "feature/"  # åŠŸèƒ½åˆ†æ”¯å‰ç¼€
  hotfix_branch_prefix: "hotfix/"  # çƒ­ä¿®å¤åˆ†æ”¯å‰ç¼€
  release_branch_prefix: "release/"  # å‘å¸ƒåˆ†æ”¯å‰ç¼€

# Mercurial æ ‡ç­¾ç­–ç•¥
tag_strategy:
  release_tag_prefix: "v"  # å‘å¸ƒæ ‡ç­¾å‰ç¼€
  rc_tag_suffix: "-rc"  # å€™é€‰å‘å¸ƒæ ‡ç­¾åç¼€
  beta_tag_suffix: "-beta"  # Beta ç‰ˆæœ¬æ ‡ç­¾åç¼€
  alpha_tag_suffix: "-alpha"  # Alpha ç‰ˆæœ¬æ ‡ç­¾åç¼€

# Mercurial å·¥ä½œæµé…ç½®
workflow:
  centralized: true  # æ˜¯å¦ä½¿ç”¨é›†ä¸­å¼å·¥ä½œæµ
  feature_branch: true  # æ˜¯å¦ä½¿ç”¨åŠŸèƒ½åˆ†æ”¯
  code_review: true  # æ˜¯å¦éœ€è¦ä»£ç å®¡æŸ¥
  automated_testing: true  # æ˜¯å¦éœ€è¦è‡ªåŠ¨åŒ–æµ‹è¯•
  continuous_integration: true  # æ˜¯å¦ä½¿ç”¨æŒç»­é›†æˆ

# é‡è¦ï¼šè¿™äº›å˜é‡ä»…ç”¨äºæ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ Ansible Vault æˆ–å¤–éƒ¨é…ç½®ç®¡ç†
# âš ï¸ è­¦å‘Šï¼šSSH ç§é’¥å’Œ HTTP å¯†ç éœ€è¦å®‰å…¨å­˜å‚¨ï¼Œå»ºè®®ä½¿ç”¨ Ansible Vault åŠ å¯†
# ğŸ”’ å®‰å…¨æç¤ºï¼šä½¿ç”¨æœ€å°æƒé™åŸåˆ™é…ç½®ä»“åº“è®¿é—®æƒé™
# ğŸ“ æ³¨æ„ï¼šä»“åº“ URL å’Œç‰ˆæœ¬éœ€è¦æ ¹æ®å®é™…é¡¹ç›®è°ƒæ•´
# ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼šæ ¹æ®ç½‘ç»œç¯å¢ƒè°ƒæ•´å…‹éš†å’Œæ›´æ–°é¢‘ç‡
# ğŸ” ç›‘æ§å»ºè®®ï¼šç›‘æ§éƒ¨ç½²æ“ä½œçš„æˆåŠŸç‡å’Œè€—æ—¶
# ğŸ›¡ï¸ å®‰å…¨åŠ å›ºï¼šå®šæœŸè½®æ¢ SSH å¯†é’¥å’Œè®¿é—®å‡­è¯
# ğŸ“Š å®¹é‡è§„åˆ’ï¼šç›‘æ§éƒ¨ç½²ç›®å½•çš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
# ğŸ”§ Mercurial ç‰¹æœ‰ï¼šåˆ©ç”¨ Mercurial çš„å‘½ååˆ†æ”¯å’Œä¹¦ç­¾åŠŸèƒ½ä¼˜åŒ–å·¥ä½œæµ
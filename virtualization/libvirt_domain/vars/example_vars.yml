# âš ï¸ è¯·å‹¿åœ¨ç¤ºä¾‹ä¸­å†™å…¥çœŸå® cloud-init å¯†é’¥/å¯†ç ï¼Œå»ºè®®ï¼š
# ansible-vault encrypt virtualization/libvirt_domain/vars/example_vars.yml

libvirt_uri: qemu:///system
libvirt_domain_name: lab-vm-01
libvirt_memory_mb: 4096
libvirt_vcpus: 2
libvirt_disk_image: /var/lib/libvirt/images/lab-vm-01.qcow2
libvirt_network_name: default

libvirt_domain_xml: |
  <domain type='kvm'>
    <name>{{ libvirt_domain_name }}</name>
    <memory unit='MiB'>{{ libvirt_memory_mb }}</memory>
    <vcpu>{{ libvirt_vcpus }}</vcpu>
    <os>
      <type arch='x86_64'>hvm</type>
    </os>
    <devices>
      <disk type='file' device='disk'>
        <driver name='qemu' type='qcow2'/>
        <source file='{{ libvirt_disk_image }}'/>
        <target dev='vda' bus='virtio'/>
      </disk>
      <interface type='network'>
        <source network='{{ libvirt_network_name }}'/>
        <model type='virtio'/>
      </interface>
      <console type='pty'/>
    </devices>
  </domain>

libvirt_metadata:
  env: lab
  owner: sre
  source: ansible-demo

# ğŸ“Œ å®‰å…¨æç¤º
# - å¦‚æœ XML ä¸­éœ€è¦åµŒå…¥ cloud-init/å¯†ç ï¼Œè¯·æ”¹ç”¨ {{ vault_libvirt_cloud_init }} å¼•ç”¨ã€‚
# - æ“ä½œå‰å…ˆå¤‡ä»½ /etc/libvirt/qemu/{{ libvirt_domain_name }}.xmlï¼Œä»¥åŠæ•°æ®ç£ç›˜ã€‚
# - Dry Runï¼ˆcheck_mode: trueï¼‰ä¸ä¼šçœŸæ­£å†™å…¥å®šä¹‰ï¼Œä½†ä»éœ€åœ¨æµ‹è¯•å®¿ä¸»æœºæ‰§è¡Œã€‚
